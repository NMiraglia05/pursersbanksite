<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Place Order</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    h2 { margin-top: 30px; }
    .item { margin: 5px 0; }
    .qty-select { display: none; margin-left: 10px; }
    button { margin-top: 20px; padding: 10px 15px; }
  </style>
  <script>
    function toggleQuantity(checkbox,id){
      const qty=document.getElementById(id);
      qty.style.display=checkbox.checked?'inline':'none';
      if(!checkbox.checked){qty.value='';}
    }

    function prepareForm(){
      // remove qty fields for unchecked boxes
      document.querySelectorAll('input[type="checkbox"]').forEach(cb=>{
        if(!cb.checked){
          const qty=document.getElementById('qty_'+cb.name.replace('chk_',''));
          if(qty) qty.disabled=true;
        }
      });
    }
  </script>
</head>
<body>
  <h1>Place Order</h1>
  <form action="/confirm" method="POST" onsubmit="prepareForm()">
    {% for cat,items in categories.items() %}
      <h2>{{ cat|capitalize }}</h2>
      {% for name,info in items %}
        <div class="item">
          <label>
            <input type="checkbox" name="chk_{{ name }}" onchange="toggleQuantity(this,'qty_{{ name }}')">
            {{ name }} â€” {{ info.points }} points
            {% if info.expiration %}(expires in {{ info.expiration }}){% endif %}
          </label>
          <select name="qty_{{ name }}" id="qty_{{ name }}" class="qty-select">
            {% for n in range(1,11) %}
              <option value="{{ n }}">{{ n }}</option>
            {% endfor %}
          </select>
        </div>
      {% endfor %}
    {% endfor %}
    <button type="submit">Place Order</button>
  </form>
</body>
</html>
